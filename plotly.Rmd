---
title: "Plotly examples"
author: "Xin Fang"
output: 
  html_document:
    toc: true
    toc_float: true
---

# R setup

We're going to look at NYC restaurant inspection data. Since this data set is big, we are only going to look at my favorite restaurant types (i.e. Chinese, Korean, Thai, French, Mexican, and Japanese) in Manhattan. 

```{r message = FALSE, warning = FALSE}
library(tidyverse)
library(p8105.datasets)
library(lubridate)
library(plotly)
```
# load and clean data
```{r}
data("rest_inspec")

rest_inspec <- rest_inspec %>% 
  select(boro, cuisine_description, dba, score, grade, critical_flag,grade_date) %>% 
  filter(
    grade %in% c("A", "B", "C"), 
    cuisine_description == c("Korean", "Chinese", "Japanese", "Thai", "French", "Mexican"), 
    boro == "MANHATTAN", 
    critical_flag != "Not Applicable") %>% 
  drop_na(score)
```
This rest_inspec dataset now contains `r nrow(rest_inspec)` observations. It is seems reasonable to make plots now. 

# plotly plots 

## Bar plot
```{r}
rest_inspec %>% 
  count(cuisine_description) %>% 
  mutate(cuisine_description = fct_reorder(cuisine_description, n), 
         text_label = str_c("Cuisine: ", cuisine_description, "\nN = ", n)) %>% 
  plot_ly(x = ~cuisine_description, y = ~n, color = ~cuisine_description,text = ~text_label,
          type = "bar", colors = "viridis") %>% 
  layout(
    title = "Count of restaurants in Manhattan by cuisine", 
    xaxis = list(title = "Cuisine"),
    yaxis = list(title = "Count"))
```

## Boxplot 
```{r}
rest_inspec %>% 
  mutate(text_label = str_c("Cuisine: ", cuisine_description, "\nScore: ", score)) %>%
  plot_ly(y = ~score, x = ~cuisine_description, 
          color = ~cuisine_description, 
          text = ~text_label,
          type = "box", 
          colors = "viridis") %>% 
  layout(
    title = "Scores of restaurants in Manhattan grouped by my favorite cuisine types", 
    xaxis = list(title = "Cuisine types"),
    yaxis = list(title = "Inspection score"))
```


## Histogram
```{r}
rest_inspec %>%
  mutate(text_label = str_c( "critical status:", critical_flag, "\nScore: ", score)) %>%
  plot_ly(x = ~score, type = "histogram", color = ~critical_flag, alpha = .8, hovertext = ~text_label, colors = "viridis") %>% 
  layout(title = "Histogram of inspection scores of NY restaurants",
         xaxis = list(title = "Score"),
         yaxis = list(title = "Count"))
```